---
# smoke-test.yml
# Basic smoke tests to validate platform functionality

- name: Platform Smoke Tests
  hosts: all
  gather_facts: true
  any_errors_fatal: true

  tasks:
    - name: Check system connectivity
      ansible.builtin.ping:

    - name: Validate package manager
      ansible.builtin.package:
        name: curl
        state: present
      when: ansible_os_family != "Windows"

    - name: Test HTTP connectivity
      ansible.builtin.uri:
        url: https://httpbin.org/status/200
        status_code: 200
      register: http_test
      failed_when: http_test.status != 200

    - name: Validate disk space
      ansible.builtin.assert:
        that: ansible_facts.mounts | selectattr('mount', 'equalto', '/') | map(attribute='size_available') | first | float > 1000000000
        fail_msg: "Insufficient disk space on root filesystem"

    - name: Smoke test summary
      ansible.builtin.debug:
        msg: |
          ✅ Platform smoke tests passed!
          Hosts tested: {{ ansible_play_hosts_all | length }}
          Connectivity: ✅
          HTTP access: ✅
          Disk space: ✅
          All systems operational.
